(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{4856:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>w,dynamic:()=>N,dynamicParams:()=>y,fetchCache:()=>b});var a=s(1033),l=s(4109),n=s(4310);function r(e,t,s,a){return s===t?a/2:(e-t)/(s-t)*a}function c(e){let{series:t,w:s=700,h:l=240}=e;if(!t.length)return(0,a.jsx)("div",{className:"p-4 border rounded",children:"No data"});let n=s-48,c=l-48,o=t.flatMap(e=>e.points.map(e=>e.y)),i=t.flatMap(e=>e.points.map(e=>e.x)),d=Math.min(...o),u=Math.max(...o),x=Math.min(...i),h=Math.max(...i);return(0,a.jsx)("svg",{width:s,height:l,className:"rounded-xl w-full",children:(0,a.jsxs)("g",{transform:"translate(".concat(24,",").concat(24,")"),children:[(0,a.jsx)("line",{x1:0,y1:c,x2:n,y2:c,stroke:"currentColor",opacity:"0.2"}),(0,a.jsx)("line",{x1:0,y1:0,x2:0,y2:c,stroke:"currentColor",opacity:"0.2"}),t.map((e,t)=>{let s=e.points.map((e,t)=>{let s=r(e.x,x,h,n),a=c-r(e.y,d,u,c);return"".concat(t?"L":"M").concat(s,",").concat(a)}).join(" ");return(0,a.jsx)("path",{d:s,fill:"none",stroke:"currentColor",strokeWidth:2},t)}),(0,a.jsx)("text",{x:0,y:-6,fontSize:"10",children:u.toFixed(0)}),(0,a.jsx)("text",{x:0,y:c+12,fontSize:"10",children:d.toFixed(0)})]})})}var o=s(646);let i=o.env.NEXT_PUBLIC_API_BASE||"http://localhost:8000";function d(e){let{service:t,from:s,to:n}=e,[r,c]=(0,l.useState)(null);if((0,l.useEffect)(()=>{let e=new URLSearchParams;s&&e.set("from_",s),n&&e.set("to",n),t&&e.set("service",t);let a={};o.env.NEXT_PUBLIC_API_TOKEN&&(a.authorization="Bearer ".concat(o.env.NEXT_PUBLIC_API_TOKEN)),fetch("".concat(i,"/alerts").concat(e.toString()?"?".concat(e):""),{cache:"no-store",headers:a}).then(e=>e.ok?e.json():Promise.reject(Error(String(e.status)))).then(e=>c(e)).catch(()=>c([]))},[t,s,n]),null===r)return(0,a.jsx)("div",{className:"panel p-3 animate-pulse text-sm",children:"Loading alerts…"});if(!r.length)return null;let d=r[0],u="critical"===d.severity?"bg-red-500/20 border-red-400/40 text-red-200":"warning"===d.severity?"bg-amber-500/20 border-amber-400/40 text-amber-200":"bg-blue-500/20 border-blue-400/40 text-blue-200";return(0,a.jsxs)("div",{className:"p-3 rounded-xl border ".concat(u),children:[(0,a.jsxs)("div",{className:"text-sm font-semibold",children:["Alert — ",d.severity.toUpperCase()]}),(0,a.jsx)("div",{className:"text-sm",children:d.message}),(0,a.jsx)("div",{className:"text-xs opacity-70 mt-1",children:new Date(d.created_at).toLocaleString()})]})}function u(e){let{label:t,value:s}=e;return(0,a.jsxs)("div",{className:"p-3 card",children:[(0,a.jsx)("div",{className:"text-xs text-neutral-300",children:t}),(0,a.jsx)("div",{className:"text-xl font-semibold",children:s})]})}function x(e){let{height:t=180}=e;return(0,a.jsx)("div",{className:"rounded-xl panel animate-pulse",style:{height:t}})}function h(e){let{title:t,subtitle:s}=e;return(0,a.jsxs)("div",{className:"text-center py-10 text-sm",children:[(0,a.jsx)("div",{className:"font-semibold",children:t}),s&&(0,a.jsx)("div",{className:"opacity-70",children:s})]})}var m=s(646);let v="/api";function f(){let e={},t=m.env.NEXT_PUBLIC_API_TOKEN;return t&&(e.authorization="Bearer ".concat(t),e["x-api-token"]=t,e["x-api-key"]=t),e}async function j(e){let t=new URLSearchParams;e.from&&t.set("from",e.from),e.to&&t.set("to",e.to),e.service&&t.set("service",e.service);let s="".concat(v,"/costs/aggregate").concat(t.toString()?"?".concat(t):""),a=await fetch(s,{cache:"no-store",headers:f(),signal:e.signal});if(!a.ok){let e=await a.text().catch(()=>"");throw Error("".concat(a.status," ").concat(e))}return await a.json()}async function p(e){let t=new URLSearchParams;e.from&&t.set("from",e.from),e.to&&t.set("to",e.to),e.service&&t.set("service",e.service);let s="".concat(v,"/costs/").concat(t.toString()?"?".concat(t):""),a=await fetch(s,{cache:"no-store",headers:f(),signal:e.signal});if(!a.ok){let e=await a.text().catch(()=>"");throw Error("".concat(a.status," ").concat(e))}return await a.json()}async function g(e){let t=new URLSearchParams;e.from&&t.set("from",e.from),e.to&&t.set("to",e.to);let s="".concat(v,"/costs/aggregate").concat(t.toString()?"?".concat(t):""),a=await fetch(s,{cache:"no-store",headers:f(),signal:e.signal});if(!a.ok){let e=await a.text().catch(()=>"");throw Error("".concat(a.status," ").concat(e))}return Array.from(new Set((await a.json()).map(e=>e.service))).sort()}let N="force-dynamic",b="force-no-store",y=!0;function w(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsxs)("div",{className:"p-8",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Cloud Cost Copilot"}),(0,a.jsx)("div",{className:"mt-6 p-4 panel",children:"Loading…"})]}),children:(0,a.jsx)(S,{})})}function S(){var e;let t=function(){let e=(0,n.useRouter)(),t=(0,n.usePathname)(),s=(0,n.useSearchParams)();return{get:e=>{var t;return null!=(t=null==s?void 0:s.get(e))?t:""},set:function(a,l){let n=new URLSearchParams((null==s?void 0:s.toString())||"");l?n.set(a,l):n.delete(a);let r=n.toString();e.replace("".concat(t).concat(r?"?".concat(r):""),{scroll:!1})}}}(),s=t.get("from"),r=t.get("to"),o=t.get("service"),[i,m]=(0,l.useState)([]),[v,f]=(0,l.useState)(!0),[N,b]=(0,l.useState)([]),[y,w]=(0,l.useState)([]),[S,C]=(0,l.useState)(null),[k,_]=(0,l.useState)(!1),[P,E]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=!0,a=new AbortController;return(async()=>{_(!0),E(null);try{let l=await g({from:s,to:r,signal:a.signal});if(!e)return;w(l),!l.length||o&&l.includes(o)||t.set("service",l[0])}catch(t){if(!e)return;w([]),E((null==t?void 0:t.message)||"Failed to load services")}finally{e&&_(!1)}})(),()=>{e=!1,a.abort()}},[s,r]),(0,l.useEffect)(()=>{let e=!0,t=new AbortController,a=new AbortController;return f(!0),C(null),Promise.allSettled([p({from:s,to:r,service:o,signal:t.signal}).then(t=>{e&&m(t)}).catch(t=>{e&&(m([]),C(e=>null!=e?e:"Failed to load table (".concat(t.message,")")))}),j({from:s,to:r,service:o,signal:a.signal}).then(t=>{e&&b(t)}).catch(t=>{e&&(b([]),C(e=>null!=e?e:"Failed to load chart (".concat(t.message,")")))})]).finally(()=>{e&&f(!1)}),()=>{e=!1,t.abort(),a.abort()}},[s,r,o]);let L=(0,l.useMemo)(()=>{var e,t;let s=N.filter(e=>!o||e.service===o).sort((e,t)=>e.day.localeCompare(t.day)),a=s.map((e,t)=>({x:t,y:e.total}));return[{name:o||(null!=(t=null==(e=s[0])?void 0:e.service)?t:"All"),points:a}]},[N,o]),A=(0,l.useMemo)(()=>i.reduce((e,t)=>{var s;return e+(null!=(s=t.amount)?s:0)},0),[i]);return(0,a.jsxs)("div",{className:"p-6 md:p-8",children:[(0,a.jsxs)("header",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold tracking-tight",children:"Cloud Cost Copilot"}),(0,a.jsx)("p",{className:"text-sm opacity-70",children:"Real-time cloud cost anomalies with alerts and suggestions."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[(0,a.jsx)("aside",{className:"lg:col-span-4 xl:col-span-3",children:(0,a.jsxs)("div",{className:"sticky top-4 space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 panel",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold mb-3",children:"Filters"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium",children:"From"}),(0,a.jsx)("input",{type:"date",value:s,onChange:e=>t.set("from",e.target.value||null),className:"w-full input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium",children:"To"}),(0,a.jsx)("input",{type:"date",value:r,onChange:e=>t.set("to",e.target.value||null),className:"w-full input"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium",children:"Service"}),(0,a.jsxs)("select",{value:o||(null!=(e=y[0])?e:""),onChange:e=>t.set("service",e.target.value||null),className:"w-full input",disabled:k,children:[k&&(0,a.jsx)("option",{value:"",children:"Loading…"}),!k&&0===y.length&&(0,a.jsx)("option",{value:"",children:"No services for this range"}),!k&&y.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]}),P&&(0,a.jsx)("p",{className:"text-xs text-red-300 mt-1",children:P})]}),(s||r||o)&&(0,a.jsx)("button",{onClick:()=>{t.set("from",null),t.set("to",null),t.set("service",null)},className:"w-full input",children:"Reset"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsx)(u,{label:"Total",value:"$".concat(A.toFixed(2))}),(0,a.jsx)(u,{label:"Service",value:o||"—"}),(0,a.jsx)(u,{label:"From",value:s||"—"}),(0,a.jsx)(u,{label:"To",value:r||"—"})]})]})}),(0,a.jsxs)("main",{className:"lg:col-span-8 xl:col-span-9 space-y-4",children:[(0,a.jsx)(d,{service:o||void 0,from:s||void 0,to:r||void 0}),(0,a.jsxs)("section",{className:"p-4 panel",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold mb-2",children:"Cost over time"}),v?(0,a.jsx)(x,{height:260}):L[0].points.length?(0,a.jsx)(c,{series:L,h:260}):(0,a.jsx)(h,{title:"No data",subtitle:"Try a different date range or service."})]}),(0,a.jsxs)("section",{className:"p-4 panel",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("h2",{className:"text-sm font-semibold",children:"Details"}),(0,a.jsxs)("span",{className:"text-xs opacity-70",children:[i.length," rows"]})]}),v?(0,a.jsx)(x,{height:160}):i.length?(0,a.jsx)("div",{className:"overflow-auto",children:(0,a.jsxs)("table",{className:"table min-w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left border-b",children:[(0,a.jsx)("th",{children:"Day"}),(0,a.jsx)("th",{children:"Service"}),(0,a.jsx)("th",{children:"Amount"})]})}),(0,a.jsx)("tbody",{children:i.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{children:e.day}),(0,a.jsx)("td",{children:e.service}),(0,a.jsx)("td",{children:(null!=(t=e.amount)?t:0).toFixed(2)})]},"".concat(e.id,"-").concat(e.day,"-").concat(e.service))})})]})}):(0,a.jsx)(h,{title:"No rows",subtitle:"No costs for this selection."})]}),S&&(0,a.jsx)("div",{className:"p-3 border border-red-500/40 bg-red-900/30 text-red-200 text-sm rounded",children:S})]})]})]})}},7427:(e,t,s)=>{Promise.resolve().then(s.bind(s,4856))}},e=>{e.O(0,[295,687,358],()=>e(e.s=7427)),_N_E=e.O()}]);